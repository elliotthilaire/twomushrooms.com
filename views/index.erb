<div class="row">
  <div class="col-sm-12">
  <% @photos.each do |photo| %>
    <div class="box">
      <div class="picture">
        <a href="gallery/<%= photo.slug %>" >
          <img src="<%= photo.image.thumb('300x200#').url %>" />
        </a>
      </div>
    </div>
  <% end %>
  </div>
</div>

<div class="hide">
  <% @thumbnails.each do |photo| %>
    <div class="picture picturelist">
      <a href="gallery/<%= photo.slug %>" >
          <img src="<%= photo.image.thumb('300x200#').url %>" />
      </a>
    </div>
  <% end %>
</div>


<script>
	jQuery(document).ready(function($) {

    // Create array of elements from HTML
    myArray = $('.picturelist').toArray();
		
    //var thumbnails = <%= @thumbnails %>
    var curr = 13;   
    var numberOfBoxes = jQuery(".box").size();

    // preload images
    //jQuery.each(thumbnails, loadImage);
    //function loadImage(key,value){
    //  jQuery.ajax(value.url);
    //}


    // create random ordered indexes
    var list = [];
    for (var i = 0; i < numberOfBoxes; i++) {
        list.push(i);
    }

    //function randOrd(){
    //  return (Math.round(Math.random())-0.5);
    //}
    //list.sort(randOrd);

    // function for getting the next random image
    var i = 1;
    function nextImage(){
      i = (i + 1) % numberOfBoxes;
      return list[i];
    }

    TIMEOUT = 3000;
    FADEIN_TIME = 2500;
    setTimeout(swapImage,TIMEOUT);

      // get a random url and swap the image
      function swapImage(){
        //curr = (curr + 1) % thumbnails.length;
        //url = thumbnails[curr].url;
        //slug = thumbnails[curr].slug;

        //pick a random box
        var random = Math.round(Math.random()*numberOfBoxes);
        randomBox = jQuery(".box").eq(nextImage());
         
        // add .bottom class
        randomBox.find('.picture').addClass("bottom", fadeNew());

        function fadeNew(){

          // get picture from array
          var html = myArray.shift();

          // Add the new image and fade it in
          $(html).hide().appendTo(randomBox);
          randomBox.find(':not(.bottom)').fadeIn(FADEIN_TIME, removePreviousPicture);
        }

        // remove the old image
        function removePreviousPicture(){
          randomBox.find(".bottom").remove();
        }

        //recurse into this function to do it all again
        setTimeout(swapImage, TIMEOUT);

      }
      
    });

</script>

